<!DOCTYPE html>
<html>
<head>
    <title>Advanced Infix Calculator</title>
</head>
<body>
<h2>Infix Expression Calculator</h2>
<input type="text" id="infix" placeholder="E.g., 3+sqrt(16)*2^3">
<button onclick="calculate()">Evaluate</button>

<p id="postfixOutput"></p>
<p id="resultOutput"></p>

<script>
// Helper functions
function isOperator(c) {
    return ['+', '-', '*', '/', '^'].includes(c);
}

function priority(op) {
    if (op === '+' || op === '-') return 1;
    if (op === '*' || op === '/') return 2;
    if (op === '^') return 3;
    if (op === '√') return 4; // highest priority
    return 0;
}

function isRightAssociative(op) {
    return op === '^' || op === '√';
}

// Convert infix to postfix
function infixToPostfix(expr) {
    let stack = [];
    let postfix = [];
    let i = 0;

    while (i < expr.length) {
        let c = expr[i];

        if (c === ' ') { i++; continue; }

        // Multi-digit number or decimal
        if (!isNaN(c) || c === '.') {
            let num = '';
            while (i < expr.length && (!isNaN(expr[i]) || expr[i] === '.')) {
                num += expr[i++];
            }
            postfix.push(num);
            continue;
        }

        // Function: sqrt()
        if (expr.substring(i, i+4) === "sqrt") {
            stack.push('√');
            i += 4;
            continue;
        }

        if (c === '(') {
            stack.push(c);
        } else if (c === ')') {
            while (stack.length && stack[stack.length-1] !== '(') {
                postfix.push(stack.pop());
            }
            stack.pop(); // remove '('
        } else if (isOperator(c)) {
            while (
                stack.length &&
                stack[stack.length-1] !== '(' &&
                (priority(stack[stack.length-1]) > priority(c) ||
                 (priority(stack[stack.length-1]) === priority(c) && !isRightAssociative(c)))
            ) {
                postfix.push(stack.pop());
            }
            stack.push(c);
        }
        i++;
    }

    while (stack.length) {
        postfix.push(stack.pop());
    }

    return postfix;
}

// Evaluate postfix
function evaluatePostfix(postfix) {
    let stack = [];

    for (let token of postfix) {
        if (!isNaN(token)) {
            stack.push(parseFloat(token));
        } else if (token === '√') {
            let a = stack.pop();
            stack.push(Math.sqrt(a));
        } else {
            let b = stack.pop();
            let a = stack.pop();
            switch(token) {
                case '+': stack.push(a+b); break;
                case '-': stack.push(a-b); break;
                case '*': stack.push(a*b); break;
                case '/': stack.push(a/b); break;
                case '^': stack.push(Math.pow(a,b)); break;
            }
        }
    }

    return stack.pop();
}

// Main function
function calculate() {
    const expr = document.getElementById('infix').value;
    const postfix = infixToPostfix(expr);
    const result = evaluatePostfix(postfix);

    document.getElementById('postfixOutput').innerText = "Postfix: " + postfix.join(' ');
    document.getElementById('resultOutput').innerText = "Result: " + result;
}
</script>
</body>
</html>
